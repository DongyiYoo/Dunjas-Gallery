<!DOCTYPE html>
<html>
<head>
    <title>Dunja Gallery</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f9f9f9; }
        
        .artwork { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin-bottom: 20px; 
            border-radius: 8px; 
            background: white; 
            max-width: 500px;
        }
 
        .artwork img { max-width: 100%; border-radius: 5px; margin-bottom: 10px; }
        
        .delete-btn { background-color: #ff4d4d; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>
    <a href="/" style="text-decoration: none;">
        Dunja Gallery
    </a>
</h1>

    <% if (user) { %>
        <p>Welcom to my Gallery, <b><%= user.username %></b>. (<a href="/logout">Logout</a>)</p>
    <% } else { %>
        <p><a href="/login">Login (Admin)</a></p>
    <% } %>

    <hr>

    <form action="/" method="GET">
        <input type="text" name="search" placeholder="Search here..." value="<%- search || '' %>">
        <button type="submit">Search</button>
    </form>
    
    <% if (search) { %>
        <h3>Result: <%- search %></h3>
    <% } %>

    <hr>

    <h2>Gallery</h2>
    
    <% if (artworks.length === 0) { %>
        <p>No artwork is found.</p>
    <% } %>

    <% artworks.forEach(function(art) { %>
        <div class="artwork">
            <h3><%= art.title %></h3>
            
            <% if (art.image_url) { %>
                <img src="<%= art.image_url %>" alt="Art Image"><br>
            <% } %>
            
            <p>Description: <%- art.description %></p>

            <form action="/delete" method="POST" style="margin-top:10px;">
                <input type="hidden" name="id" value="<%= art.id %>">
                <button type="submit" class="delete-btn">Delete</button>
            </form>
        </div>
    <% }); %>

    <hr>

    <h3>Add an artwork</h3>
    <form action="/add" method="POST" style="background:#eee; padding:15px; border-radius:5px;">
        <input type="text" name="title" placeholder="Art Title" required><br><br>
        <input type="text" name="image_url" placeholder="Image URL (http://...)" style="width:100%;"><br><br>
        <input type="text" name="description" placeholder="description" required><br><br>
        <button type="submit">Add</button>
    </form>

    <hr>

    <h3>DOM XSS Test</h3>
    <p>Test URL: <code>localhost:6789/#&lt;img src=x onerror=alert(1)&gt;</code></p>
    <div id="dom-target"></div>

    <script>
        if(window.location.hash) {
            var hash = decodeURIComponent(window.location.hash.substring(1));
            document.getElementById("dom-target").innerHTML = hash;
        }
    </script>
</body>
</html>